<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SCL-90 症状自评量表（科技感版）</title>
    <style>
      :root {
        --bg-gradient: linear-gradient(145deg, #0b1224, #1a2c4f);
        --card-bg: rgba(255, 255, 255, 0.08);
        --primary: #2463ff;
        --primary-glow: #5b8cff;
        --text-main: #e8edff;
        --text-muted: #a9b5d2;
        --accent: #00b7ff;
        --danger: #ff5570;
        --radius: 14px;
        --shadow: 0 0 18px rgba(36, 99, 255, 0.2);
        --blur: blur(12px);
      }
      html,
      body {
        margin: 0;
        height: 100%;
        background: var(--bg-gradient);
        font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
        color: var(--text-main);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      .app {
        max-width: 820px;
        margin: 0 auto;
        padding: 16px;
      }
      .card {
        background: var(--card-bg);
        backdrop-filter: var(--blur);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 22px;
        margin-bottom: 16px;
        transition: all 0.3s ease;
      }
      .card:hover {
        box-shadow: 0 0 20px rgba(36, 99, 255, 0.35);
      }
      header {
        display: flex;
        align-items: center;
        gap: 14px;
      }
      .logo {
        width: 54px;
        height: 54px;
        border-radius: 12px;
        background: linear-gradient(135deg, #2463ff, #00c6ff);
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: 700;
        font-size: 20px;
        color: #fff;
        box-shadow: 0 0 12px rgba(36, 99, 255, 0.8);
      }
      h1 {
        font-size: 20px;
        font-weight: 700;
        margin: 0;
      }
      p.lead {
        margin: 6px 0 0;
        color: var(--text-muted);
        font-size: 14px;
      }
      .progress-wrap {
        height: 10px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 999px;
        margin-top: 16px;
        overflow: hidden;
      }
      .progress {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #00b7ff, #2463ff);
        border-radius: 999px;
        transition: width 0.3s ease;
        box-shadow: 0 0 10px rgba(36, 99, 255, 0.8);
      }
      .question-area {
        margin-top: 20px;
      }
      .q-title {
        font-size: 17px;
        font-weight: 600;
        margin-bottom: 12px;
        color: #fff;
      }
      .q-sub {
        font-size: 13px;
        color: var(--text-muted);
        margin-bottom: 16px;
      }
      .opts {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .opt {
        position: relative;
        display: flex;
        align-items: center;
        gap: 14px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 14px;
        cursor: pointer;
        transition: all 0.25s ease;
      }
      .opt:hover {
        background: rgba(36, 99, 255, 0.12);
        border-color: var(--primary);
      }
      .opt.selected {
        border-color: var(--primary);
        background: linear-gradient(135deg, rgba(36, 99, 255, 0.2), rgba(0, 183, 255, 0.3));
        box-shadow: 0 0 12px rgba(36, 99, 255, 0.5);
      }
      .opt .tag {
        min-width: 40px;
        height: 40px;
        border-radius: 10px;
        background: rgba(36, 99, 255, 0.15);
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: 700;
        color: #7ac7ff;
        border: 1px solid rgba(36, 99, 255, 0.3);
        transition: all 0.3s ease;
      }
      .opt.selected .tag {
        background: var(--primary);
        color: #fff;
        border-color: #00b7ff;
        box-shadow: 0 0 10px rgba(36, 99, 255, 0.6);
      }
      .opt .text {
        flex: 1;
        font-size: 15px;
        color: #eaefff;
      }
      .opt .checkmark::after {
        content: "✔";
        color: #00cfff;
        font-weight: 700;
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0;
        transition: 0.3s;
      }
      .opt.selected .checkmark::after {
        opacity: 1;
        text-shadow: 0 0 10px #00cfff;
      }
      .controls {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .btn {
        padding: 10px 18px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: 0.25s;
      }
      .btn.primary {
        background: linear-gradient(135deg, #2463ff, #00c6ff);
        color: #fff;
        box-shadow: 0 0 16px rgba(36, 99, 255, 0.5);
      }
      .btn.primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 0 20px rgba(36, 99, 255, 0.8);
      }
      .btn.ghost {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: var(--accent);
      }
      .btn.ghost:hover {
        background: rgba(36, 99, 255, 0.15);
      }
      .wrongbox {
        margin-top: 10px;
        display: inline-block;
        background: rgba(255, 85, 112, 0.2);
        color: var(--danger);
        border: 1px solid rgba(255, 85, 112, 0.4);
        border-radius: 10px;
        padding: 6px 12px;
      }
      table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 10px;
  font-size: 14px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 10px rgba(36, 99, 255, 0.15);
}
thead th {
  background: rgba(36, 99, 255, 0.25);
  color: #a8c8ff;
  padding: 10px;
  font-weight: 600;
  text-shadow: 0 0 6px rgba(36, 99, 255, 0.3);
  border-bottom: 2px solid rgba(255, 255, 255, 0.08);
}
tbody td {
  padding: 10px;
  text-align: center;
  color: #eaf0ff;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  transition: background 0.3s ease, color 0.3s ease;
}
tbody tr:hover {
  background: rgba(36, 99, 255, 0.12);
  box-shadow: 0 0 8px rgba(36, 99, 255, 0.25) inset;
}
td.red {
  color: #ff88a2 !important;
  font-weight: 600;
  text-shadow: 0 0 8px rgba(255, 136, 162, 0.4);
}
td.green {
  color: #82ffb0 !important;
  font-weight: 600;
  text-shadow: 0 0 8px rgba(130, 255, 176, 0.4);
}
tr.note-row td {
  text-align: justify;
  line-height: 1.7;
  color: #c9d6ff;
  font-size: 13.5px;
  padding-top: 14px;
}

      footer {
        font-size: 12px;
        text-align: center;
        color: var(--text-muted);
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="card" id="mainCard">
        <header>
          <div class="logo">S90</div>
          <div>
            <h1>SCL-90 症状自评量表</h1>
            <p class="lead">请根据最近一周的实际感觉，选择最符合自己的选项。</p>
          </div>
        </header>
        <div class="progress-wrap">
          <div id="progress" class="progress"></div>
        </div>
        <div class="question-area" id="questionArea"></div>
        <div class="controls">
          <button id="prevBtn" class="btn ghost">上一步</button>
          <button id="nextBtn" class="btn primary">下一步</button>
        </div>
        <div class="wrongbox" id="wrongBox" style="display:none;">请选择一个选项后再继续</div>
      </div>
      <div id="resultCard" class="card" style="display:none;">
        <h2 style="text-align:center;color:#7ac7ff;margin-bottom:8px">SCL-90 量表测评结果报告</h2>
        <div id="overallTableContainer"></div>
        <div id="factorTableContainer"></div>
        <div id="factorDescContainer"></div>
        <div style="text-align:center;margin-top:16px">
          <button id="restart" class="btn primary">重新作答</button>
        </div>
      </div>
      <footer>版本：科技感主题 1.1</footer>
    </div>
    <script>
      const QUESTIONS = [
        "头痛",
        "神经过敏，心中不踏实",
        "头脑中有不必要的想法或字句盘旋",
        "头昏或昏倒",
        "对异性的兴趣减弱",
        "对旁人责备求全",
        "感到别人能控制你的思想",
        "责怪别人制造麻烦",
        "忘性大",
        "担心自己的服饰整齐或仪表的端正",
        "容易烦恼和激动",
        "胸痛",
        "害怕空旷的场所或街道",
        "感到自己的精力下降，活动减弱",
        "想结束自己的生命",
        "听到旁人听不到的声音",
        "发抖",
        "感到大多数人都不可信任",
        "胃口不好",
        "容易哭泣",
        "同异性相处时感到害羞不自在",
        "感到受骗，中了圈套或有人想抓住你",
        "无缘无故地突然感到害怕",
        "自己不能控制的大发脾气",
        "怕单独出门",
        "经常责怪自己",
        "腰痛",
        "感到难以完成任务",
        "感到孤独",
        "感到苦闷",
        "过分担忧",
        "对事物不感兴趣",
        "感到害怕",
        "你的感情容易受到伤害",
        "旁人能知道你的私下的想法",
        "感到别人不理解你、不同情你",
        "感到别人对你不友好、不喜欢你",
        "做事必须做得很慢以保证做得正确",
        "心跳得很厉害",
        "恶心或胃部不舒服",
        "感到比不上他人",
        "肌肉酸痛",
        "感到有人在监视你、谈论你",
        "难以入睡",
        "做事必须反复检查",
        "难以做出决定",
        "怕乘电车、公共汽车、地铁或火车",
        "呼吸有困难",
        "一阵阵发冷或发热",
        "因为感到害怕而避开某些东西、场合或活动",
        "脑子变空了",
        "身体发麻或刺痛",
        "喉咙有梗塞感",
        "感到前途没有希望",
        "不能集中注意",
        "感到身体的某一部分软弱无力",
        "感到紧张或容易紧张",
        "感到手或脚发重",
        "想到死亡的事",
        "吃得太多",
        "当别人看着您或谈论您时感到不自在",
        "有一些不属于您自己的想法",
        "有想打人或伤害他人的冲动",
        "早醒",
        "必须反复洗手、点数",
        "睡得不稳不深",
        "有想摔坏或破坏东西的想法",
        "有一些别人没有的想法",
        "对别人小心谨慎",
        "在公共场所感到不自在",
        "感到任何事情都很困难",
        "一阵阵恐惧或惊恐",
        "感到公共场合吃东西很不舒服",
        "经常与人争论",
        "单独一人时神经很紧张",
        "别人对你的成绩没有作出恰当的评价",
        "即使和别人在一起也感到孤单",
        "感到坐立不安心神不定",
        "感到自己没有什么价值",
        "感到熟悉的东西变成陌生或不像是真的",
        "大叫或摔东西",
        "害怕会在公共场合昏倒",
        "感到别人想占你的便宜",
        "为一些有关性的想法而很苦恼",
        "你认为应该因为自己的过错而受到惩罚",
        "感到要很快把事情做完",
        "感到自己的身体有严重问题",
        "从未感到和其他人很亲近",
        "感到自己有罪",
        "感到自己的脑子有毛病"
    ];
      const OPTIONS = [
        { label: "A", text: "没有", val: 1 },
        { label: "B", text: "很轻", val: 2 },
        { label: "C", text: "中等", val: 3 },
        { label: "D", text: "偏重", val: 4 },
        { label: "E", text: "严重", val: 5 },
      ];
      let answers = new Array(QUESTIONS.length).fill(null);
      let idx = 0;
      const qArea = document.getElementById("questionArea");
      const progress = document.getElementById("progress");
      const wrongBox = document.getElementById("wrongBox");
      const nextBtn = document.getElementById("nextBtn");
      const prevBtn = document.getElementById("prevBtn");
      const resultCard = document.getElementById("resultCard");
      const mainCard = document.getElementById("mainCard");

      function renderQuestion(i) {
        const q = QUESTIONS[i];
        qArea.innerHTML = "";
        const title = document.createElement("div");
        title.className = "q-title";
        title.textContent = q;
        qArea.appendChild(title);
        const sub = document.createElement("div");
        sub.className = "q-sub";
        sub.textContent = "选择最符合你最近一周情况的答案";
        qArea.appendChild(sub);
        const optsWrap = document.createElement("div");
        optsWrap.className = "opts";
        OPTIONS.forEach((opt) => {
          const el = document.createElement("label");
          el.className = "opt";
          el.setAttribute("data-val", opt.val);
          el.innerHTML = `<div class='tag'>${opt.label}</div><div class='text'>${opt.text}</div><div class='checkmark'></div>`;
          if (answers[i] === opt.val) el.classList.add("selected");
          el.onclick = () => {
            answers[i] = opt.val;
            [...optsWrap.children].forEach((c) => c.classList.remove("selected"));
            el.classList.add("selected");
            setTimeout(() => goNext(), 150);
          };
          optsWrap.appendChild(el);
        });
        qArea.appendChild(optsWrap);
        progress.style.width = ((i + 1) / QUESTIONS.length) * 100 + "%";
        prevBtn.style.display = i === 0 ? "none" : "inline-block";
        nextBtn.textContent = i === QUESTIONS.length - 1 ? "完成并提交" : "下一步";
      }

      function goNext() {
        if (answers[idx] === null) {
          wrongBox.style.display = "inline-block";
          return;
        }
        wrongBox.style.display = "none";
        if (idx === QUESTIONS.length - 1) {
          showResult();
          return;
        }
        idx++;
        renderQuestion(idx);
      }
      function goPrev() {
        if (idx > 0) {
          idx--;
          renderQuestion(idx);
        }
      }
      function renderOverallTable(overall_results, overall_desc, overall_flag) {
  const container = document.getElementById('overallTableContainer');
  container.innerHTML = '';

  const table = document.createElement('table');
  table.className = 'table';

  // 表头
  const thead = document.createElement('thead');
  const headerRow = document.createElement('tr');
  ['项目', '得分', '参考', '结果'].forEach((text) => {
    const th = document.createElement('th');
    th.textContent = text;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);

  // 表体
  const tbody = document.createElement('tbody');
  for (const name in overall_results) {
    const row = document.createElement('tr');
    const data = overall_results[name];
    [name, data['A'], data['B'], data['C']].forEach((text, index) => {
      const td = document.createElement('td');
      td.textContent = text;
      if (index === 3) {
        if (text === '阴性' || text === '正常') td.classList.add('green');
        else td.classList.add('red');
      }
      row.appendChild(td);
    });
    tbody.appendChild(row);
  }

  // 描述行
  const descRow = document.createElement('tr');
  descRow.className = 'note-row';
  const descTd = document.createElement('td');
  descTd.colSpan = 4;
  descTd.innerHTML = `
    <div>
      <div style="font-weight:600; color:#00b7ff; margin-bottom:6px;">说明：</div>
      根据全国正常人SCL-90常模（N=1388，1-5级评分，国内医院常用标准），当测试总分超过160分或阳性项目数超过43项时，可能存在一定的心理或情绪压力。
      <span style="color:#7ac7ff;">您的测试总分为 ${overall_results.总分.A} 分，阳性项目数为 ${overall_results.阳性项目数.A} 项，
      综合结果显示您 ${overall_desc}，总体评估为 ${overall_flag}。按总症状指数，目前的测试评级为 ${overall_results.总症状指数.C}。</span>
      <br>需要说明的是，SCL-90量表是一种辅助筛查工具，结果仅供参考，不能替代专业的心理或医学诊断。
    </div>`;
  descRow.appendChild(descTd);
  tbody.appendChild(descRow);

  table.appendChild(tbody);
  container.appendChild(table);
}

function renderFactorTable(factor_results) {
  const container = document.getElementById('factorTableContainer');
  container.innerHTML = '';

  const table = document.createElement('table');
  table.className = 'table';

  const thead = document.createElement('thead');
  const headerRow = document.createElement('tr');
  ['因子', '总分', '均分', '判定', 'M±SD'].forEach((text) => {
    const th = document.createElement('th');
    th.textContent = text;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  for (const name in factor_results) {
    const row = document.createElement('tr');
    const data = factor_results[name];
    [name, data['总分'], data['均分'], data['判定'], data['M±SD']].forEach(
      (text, index) => {
        const td = document.createElement('td');
        td.textContent = text;
        if (index === 3) {
          if (text === '正常') td.classList.add('green');
          else if (text !== '-') td.classList.add('red');
        }
        row.appendChild(td);
      }
    );
    tbody.appendChild(row);
  }

  const descRow = document.createElement('tr');
  descRow.className = 'note-row';
  const descTd = document.createElement('td');
  descTd.colSpan = 5;
  descTd.innerHTML = `
    <div>
      <div style="font-weight:600; color:#00b7ff; margin-bottom:6px;">说明：</div>
      根据全国正常人SCL-90常模（N=1388，1-5级评分，国内医院常用标准），每个因子均分数值范围为 1~5。
      若均分超过常模(M+SD, 平均分+标准差)，即提示筛查异常。
      <br>量表结果仅供参考，不构成诊断依据。
    </div>`;
  descRow.appendChild(descTd);
  tbody.appendChild(descRow);

  table.appendChild(tbody);
  container.appendChild(table);
}

function renderFactorDesc(factor_results, factor_desc) {
  const container = document.getElementById('factorDescContainer');
  container.innerHTML = '';

  const table = document.createElement('table');
  table.className = 'table';

  const thead = document.createElement('thead');
  const headerRow = document.createElement('tr');
  ['因子', '说明'].forEach((text) => {
    const th = document.createElement('th');
    th.textContent = text;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  for (const name in factor_results) {
    const row = document.createElement('tr');
    const data = factor_results[name];
    const td1 = document.createElement('td');
    td1.textContent = name;
    const td2 = document.createElement('td');
    td2.innerHTML = `<span style="color:#7ac7ff;font-weight:600;">你的得分为 ${data['总分']}。</span> ${factor_desc[name]}`;
    td2.classList.add('desc-cell');
    row.appendChild(td1);
    row.appendChild(td2);
    tbody.appendChild(row);
  }

  table.appendChild(tbody);
  container.appendChild(table);
}

      function showResult() {
        mainCard.style.display = "none";
        resultCard.style.display = "block";
        const filledAnswers = answers.map((v) => (v === null ? 0 : v));
        fetch("/api/scl90", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ filledAnswers }),
        })
          .then((res) => res.json())
          .then((data) => {
            renderOverallTable(
                data.overall_results,
                data.overall_desc,
                data.overall_flag
              )
              renderFactorTable(data.factor_results)
              renderFactorDesc(data.factor_results, data.factor_desc)
          })
          .catch((e) => {
            console.error(err)
          });
      }
      function restart() {
        answers.fill(null);
        idx = 0;
        resultCard.style.display = "none";
        mainCard.style.display = "block";
        renderQuestion(0);
      }
      prevBtn.addEventListener("click", goPrev);
      nextBtn.addEventListener("click", goNext);
      document.getElementById("restart").addEventListener("click", restart);
      renderQuestion(0);
    </script>
  </body>
</html>
